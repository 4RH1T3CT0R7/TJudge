apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: tjudge

resources:
  - namespace.yaml
  - configmap.yaml
  - secrets.yaml
  - postgres.yaml
  - redis.yaml
  - api.yaml
  - worker.yaml
  - ingress.yaml
  - hpa.yaml
  - network-policies.yaml
  - monitoring.yaml
  - loki.yaml

commonLabels:
  app.kubernetes.io/managed-by: kustomize
  app.kubernetes.io/part-of: tjudge

# Image customization
images:
  - name: ghcr.io/bmstu-itstech/tjudge-api
    newTag: latest
  - name: ghcr.io/bmstu-itstech/tjudge-worker
    newTag: latest

# ConfigMap generator for additional config
configMapGenerator:
  - name: tjudge-scripts
    files:
      - scripts/init-db.sh

# Patches for environment-specific changes
# patchesStrategicMerge:
#   - patches/production.yaml

# Replicas customization
# replicas:
#   - name: tjudge-api
#     count: 5
#   - name: tjudge-worker
#     count: 10
