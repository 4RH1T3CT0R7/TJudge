# TJudge Configuration
# Скопируйте этот файл в .env и настройте под ваше окружение
# cp .env.example .env

# ============================================================================
# ОКРУЖЕНИЕ
# ============================================================================

# Режим работы: development | production
ENVIRONMENT=development

# ============================================================================
# API SERVER
# ============================================================================

# Порт API сервера
API_PORT=8080

# Таймауты
READ_TIMEOUT=30s
WRITE_TIMEOUT=30s
SHUTDOWN_TIMEOUT=10s

# Базовый URL приложения (для генерации ссылок)
BASE_URL=http://localhost:8080

# ============================================================================
# POSTGRESQL
# ============================================================================

# Хост базы данных
# Docker: postgres | Локально: localhost
DB_HOST=localhost

# Порт (5433 чтобы не конфликтовать с локальным PostgreSQL)
DB_PORT=5433

# Учётные данные
DB_USER=tjudge
DB_PASSWORD=secret
DB_NAME=tjudge

# Пул соединений
DB_MAX_CONNECTIONS=50
DB_MAX_IDLE=10
DB_MAX_LIFETIME=5m

# ============================================================================
# REDIS
# ============================================================================

# Хост Redis
# Docker: redis | Локально: localhost
REDIS_HOST=localhost
REDIS_PORT=6379

# Пароль (оставьте пустым если не используется)
REDIS_PASSWORD=

# Номер базы данных
REDIS_DB=0

# Размер пула соединений
REDIS_POOL_SIZE=100

# ============================================================================
# WORKER POOL
# ============================================================================

# Минимальное и максимальное количество воркеров
WORKER_MIN=10
WORKER_MAX=100

# Размер очереди задач
WORKER_QUEUE_SIZE=10000

# Таймаут выполнения одного матча
WORKER_TIMEOUT=60s

# Повторные попытки при ошибке
WORKER_RETRY_ATTEMPTS=3
WORKER_RETRY_DELAY=5s

# ============================================================================
# MATCH EXECUTOR (Docker)
# ============================================================================

# Путь к tjudge-cli (в Docker контейнере)
TJUDGE_PATH=/usr/local/bin/tjudge-cli

# Таймаут выполнения матча
EXECUTOR_TIMEOUT=30s

# Лимиты ресурсов для контейнера
EXECUTOR_CPU_QUOTA=100000
EXECUTOR_MEMORY_LIMIT=536870912
EXECUTOR_PIDS_LIMIT=100

# Отключить сеть в контейнере
EXECUTOR_NETWORK_DISABLED=true

# ============================================================================
# STORAGE
# ============================================================================

# Путь для хранения загруженных программ
# Docker: /data/programs | Локально: ./data/programs
PROGRAMS_PATH=/data/programs

# ============================================================================
# JWT AUTHENTICATION
# ============================================================================

# ВАЖНО: Измените в продакшене!
JWT_SECRET=your-secret-key-change-in-production

# Время жизни токенов
JWT_ACCESS_TTL=1h
JWT_REFRESH_TTL=168h

# ============================================================================
# LOGGING
# ============================================================================

# Уровень: debug | info | warn | error
LOG_LEVEL=info

# Формат: json | console
LOG_FORMAT=json

# Вывод: stdout | stderr | путь к файлу
LOG_OUTPUT=stdout

# Асинхронное логирование (true для высокой нагрузки)
LOG_ASYNC=false

# ============================================================================
# METRICS (Prometheus)
# ============================================================================

# Включить метрики
METRICS_ENABLED=true

# Порт для метрик
METRICS_PORT=9090

# Путь для метрик
METRICS_PATH=/metrics

# ============================================================================
# CORS
# ============================================================================

# Разрешённые источники (* для всех в development)
CORS_ALLOWED_ORIGINS=*

# Время кэширования preflight запросов
CORS_MAX_AGE=3600

# ============================================================================
# RATE LIMITING
# ============================================================================

# Включить rate limiting
RATE_LIMIT_ENABLED=false

# Запросов в минуту
RATE_LIMIT_RPM=1000

# Burst (максимум запросов за раз)
RATE_LIMIT_BURST=2000

# ============================================================================
# BACKUP
# ============================================================================

# Директория для бэкапов
BACKUP_DIR=./backups

# Срок хранения бэкапов (дней)
BACKUP_RETENTION_DAYS=7

# ============================================================================
# PERFORMANCE PROFILES
# ============================================================================
# Выберите профиль в зависимости от вашего железа:
#
# WEAK (2 ядра, 4 ГБ RAM):
#   WORKER_MIN=1, WORKER_MAX=3
#   EXECUTOR_MEMORY_LIMIT=268435456 (256 MiB)
#   EXECUTOR_CPU_QUOTA=50000 (50% CPU)
#   DB_MAX_CONNECTIONS=20
#   REDIS_POOL_SIZE=30
#
# MEDIUM (4 ядра, 8 ГБ RAM):
#   WORKER_MIN=2, WORKER_MAX=5
#   EXECUTOR_MEMORY_LIMIT=536870912 (512 MiB)
#   EXECUTOR_CPU_QUOTA=100000 (100% CPU)
#   DB_MAX_CONNECTIONS=50
#   REDIS_POOL_SIZE=50
#
# STRONG (8+ ядер, 16+ ГБ RAM):
#   WORKER_MIN=5, WORKER_MAX=20
#   EXECUTOR_MEMORY_LIMIT=1073741824 (1 GiB)
#   EXECUTOR_CPU_QUOTA=200000 (200% CPU)
#   DB_MAX_CONNECTIONS=100
#   REDIS_POOL_SIZE=100
#
# Используйте готовые профили: config/profiles/{weak,medium,strong}.env
# Запуск с профилем: make deploy-weak | make deploy-medium | make deploy-strong
