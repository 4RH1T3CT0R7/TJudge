# TJudge Performance Profile: WEAK
# Target: 2 CPU cores, 4 GB RAM
# Use case: Old laptop, entry-level VPS, development machine
#
# Usage:
#   docker-compose -f docker-compose.selfhosted.yml --env-file config/profiles/weak.env up -d
#   OR: make deploy-weak

# =============================================================================
# WORKER POOL
# =============================================================================
WORKER_MIN=1
WORKER_MAX=3
WORKER_QUEUE_SIZE=1000
WORKER_TIMEOUT=60s

# =============================================================================
# EXECUTOR (Match execution)
# =============================================================================
# 256 MiB per container - reduced to allow more parallel matches on limited RAM
EXECUTOR_MEMORY_LIMIT=268435456
# 50% of one CPU core - leaves room for system processes
EXECUTOR_CPU_QUOTA=50000
EXECUTOR_PIDS_LIMIT=50
EXECUTOR_TIMEOUT=90s

# =============================================================================
# DATABASE
# =============================================================================
DB_MAX_CONNECTIONS=20
DB_MAX_IDLE=5
DB_MAX_LIFETIME=5m

# =============================================================================
# REDIS
# =============================================================================
REDIS_POOL_SIZE=30
REDIS_MAXMEMORY=256mb

# =============================================================================
# RATE LIMITING
# =============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_RPM=50
RATE_LIMIT_BURST=100

# =============================================================================
# RESOURCE LIMITS (Docker Compose deploy)
# =============================================================================
API_CPU_LIMIT=1.0
API_MEMORY_LIMIT=512M
API_MEMORY_RESERVATION=256M

WORKER_CPU_LIMIT=1.5
WORKER_MEMORY_LIMIT=1G
WORKER_MEMORY_RESERVATION=512M

POSTGRES_MEMORY_LIMIT=512M
POSTGRES_MEMORY_RESERVATION=256M
